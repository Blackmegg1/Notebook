<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>防抖、节流和RAF | 我的云笔记本</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <meta name="description" content="">
    <meta name="author" content="Blackmegg1">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="##FFE5E5">
    
    <link rel="preload" href="/assets/css/0.styles.c14b62c2.css" as="style"><link rel="preload" href="/assets/js/app.698492e0.js" as="script"><link rel="preload" href="/assets/js/2.1aeebccc.js" as="script"><link rel="preload" href="/assets/js/26.104728fd.js" as="script"><link rel="preload" href="/assets/js/3.aa8f0b53.js" as="script"><link rel="prefetch" href="/assets/js/10.ea1077f3.js"><link rel="prefetch" href="/assets/js/11.12a41abe.js"><link rel="prefetch" href="/assets/js/12.bcf89e87.js"><link rel="prefetch" href="/assets/js/13.7e7cd09c.js"><link rel="prefetch" href="/assets/js/14.7ce9366d.js"><link rel="prefetch" href="/assets/js/15.d6d57049.js"><link rel="prefetch" href="/assets/js/16.22341b27.js"><link rel="prefetch" href="/assets/js/17.15abb292.js"><link rel="prefetch" href="/assets/js/18.3f62e3b6.js"><link rel="prefetch" href="/assets/js/19.0c10fd73.js"><link rel="prefetch" href="/assets/js/20.ce4ac51f.js"><link rel="prefetch" href="/assets/js/21.eed478b5.js"><link rel="prefetch" href="/assets/js/22.06347cdc.js"><link rel="prefetch" href="/assets/js/23.50d3bd24.js"><link rel="prefetch" href="/assets/js/24.b9d6f4d0.js"><link rel="prefetch" href="/assets/js/25.98ef4e6e.js"><link rel="prefetch" href="/assets/js/27.c63d59b1.js"><link rel="prefetch" href="/assets/js/28.a9fb6234.js"><link rel="prefetch" href="/assets/js/29.eee6a5c5.js"><link rel="prefetch" href="/assets/js/4.f7db42f0.js"><link rel="prefetch" href="/assets/js/5.704a2c3a.js"><link rel="prefetch" href="/assets/js/6.760b40be.js"><link rel="prefetch" href="/assets/js/7.be80b1a5.js"><link rel="prefetch" href="/assets/js/8.57ebe38d.js"><link rel="prefetch" href="/assets/js/9.32d381e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c14b62c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icons/favicon-32x32.png" alt="我的云笔记本" class="logo"> <span class="site-name can-hide">我的云笔记本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  目录
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端三剑客" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端三剑客" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">
  HTML
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计网
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/basic/other/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他学科" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他学科" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/philosophy/" class="nav-link">
  哲学
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Blackmegg1/Notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  目录
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端三剑客" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端三剑客" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">
  HTML
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计网
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/basic/other/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他学科" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他学科" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/philosophy/" class="nav-link">
  哲学
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Blackmegg1/Notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/js/" aria-current="page" class="sidebar-link">JavaScript基础知识</a></li><li><a href="/frontend/js/'this'的指向.html" class="sidebar-link">'this'的指向</a></li><li><a href="/frontend/js/JS习题册.html" class="sidebar-link">JS习题册</a></li><li><a href="/frontend/js/JS习题册答案.html" class="sidebar-link">JS习题册答案</a></li><li><a href="/frontend/js/防抖、节流和RAF.html" class="active sidebar-link">防抖、节流和RAF</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#什么是防抖、节流" class="sidebar-link">什么是防抖、节流？</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#为什么需要防抖" class="sidebar-link">为什么需要防抖？</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#仔细聊聊防抖" class="sidebar-link">仔细聊聊防抖：</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#前沿-immediate-触发" class="sidebar-link">前沿(immediate)触发</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#防抖实现" class="sidebar-link">防抖实现</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#防抖实例" class="sidebar-link">防抖实例</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#节流" class="sidebar-link">节流</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#节流实例" class="sidebar-link">节流实例</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#如何使用防抖、节流以及一些小坑" class="sidebar-link">如何使用防抖、节流以及一些小坑</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#requestanimationframe-请求动画帧" class="sidebar-link">requestAnimationFrame(请求动画帧)</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/frontend/js/防抖、节流和RAF.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="防抖、节流和raf"><a href="#防抖、节流和raf" class="header-anchor">#</a> 防抖、节流和RAF</h1> <h2 id="什么是防抖、节流"><a href="#什么是防抖、节流" class="header-anchor">#</a> 什么是防抖、节流？</h2> <p><strong>防抖</strong>和<strong>节流</strong>是两个十分相似但不同的概念，它们都用于控制一段时间内函数调用的次数。</p> <p>当我们的函数对DOM事件响应时，<strong>防抖</strong>和<strong>节流</strong>效果更加明显。需要注意的是，<strong>防抖</strong>和<strong>节流</strong>并没有控制DOM事件的触发频率，他们只是在事件发生与函数被调用这个过程中充当了一个缓冲层。</p> <h2 id="为什么需要防抖"><a href="#为什么需要防抖" class="header-anchor">#</a> 为什么需要防抖？</h2> <p>以常见的<strong>sroll</strong>（滚动）事件为例：</p> <p><a href="https://codepen.io/dcorb/pen/PZOZgB" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/PZOZgB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>执行上述代码，我们会发现滚动事件的触发频率非常高，可能只是轻轻拖动了下滚动条就触发了20次事件。事实上在手机上，滚动事件触发的频率会更高，这么高频事件触发无疑大大增加了事件处理函数的压力。</p> <p><img src="http://img.gxyhero.top/img/202108101729568.png" alt="image-20210322172132353"></p> <h2 id="仔细聊聊防抖"><a href="#仔细聊聊防抖" class="header-anchor">#</a> 仔细聊聊防抖：</h2> <p>用一句话概况：<strong>防抖允许我们将一组同一函数的触发序列合并为一次触发，即多化一</strong>。</p> <blockquote><p>The Debounce technique allow us to “group” multiple sequential calls in a single one.</p></blockquote> <p><img src="http://img.gxyhero.top/img/202108101730772.png" alt="debounce"></p> <p>观察上图，比较原生事件触发与带<strong>防抖</strong>的事件触发机制。需要注意的是<strong>即使事件并不是连续触发的，也会被合并为一次触发</strong>（当然不能间隔太久，这个gap可以自定，后面会说到）。</p> <p>有一个较为形象的<strong>类比</strong>：想象你现在处在一个电梯中，就在电梯门即将关闭的时候，一个人进来了，电梯不得不延迟升降，打开门让它进来，然后快关闭时又来了一个人，电梯门又开了……虽然这样推迟了电梯的升降，但是却让电梯的空间得以被充分利用。</p> <p><a href="https://codepen.io/dcorb/pen/KVxGqN" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/KVxGqN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>打开这个链接试着在Trigger area中拖动鼠标，你能清晰看到，防抖通过<strong>合并</strong>，大大减少了事件触发的次数。（这里强调了合并，因为就像一开始说的那样，防抖并没有改变事件触发的频率，它只是帮我们整理了一下）</p> <h2 id="前沿-immediate-触发"><a href="#前沿-immediate-触发" class="header-anchor">#</a> 前沿(immediate)触发</h2> <p>我们发现上面的<strong>防抖</strong>总在事件停止“抽搐”后才触发函数，这样有时对体验影响很大，为什么不能让函数立即被触发呢？就好像没有使用<strong>防抖</strong>时的那样。事实上，在<code>underscore.js</code>中，这个选项被称为<strong>immediate</strong>。下面是前沿触发防抖的例子：</p> <p><a href="https://codepen.io/dcorb/pen/GZWqNV" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/GZWqNV<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>对比之前的可以发现，函数的触发处在序列的前沿了。</p> <p><img src="http://img.gxyhero.top/img/202108101730878.png" alt="debounce-leading"></p> <h2 id="防抖实现"><a href="#防抖实现" class="header-anchor">#</a> 防抖实现</h2> <p><strong>防抖</strong>这个概念最早在2009年由John Hann在他的文章中提出：</p> <blockquote><p>http://unscriptable.com/2009/03/20/debouncing-javascript-methods/</p></blockquote> <p>目前<strong>underscore.js</strong>和<strong>Lodash</strong>中都有实现防抖，虽然它们具体实现的方式不同，但是接口无疑都是一样的。</p> <p><strong>Lodash</strong>为<strong>防抖</strong>和<strong>节流</strong>增加了更多的细节，如上文提及的<strong>immediate</strong>选项已经被替换为<strong>leading</strong>(前沿)和 <strong>trailing</strong>（后沿）供程序员选择，<strong>默认情况下采用后沿触发防抖</strong>。</p> <h2 id="防抖实例"><a href="#防抖实例" class="header-anchor">#</a> 防抖实例</h2> <h4 id="改变窗口大小"><a href="#改变窗口大小" class="header-anchor">#</a> 改变窗口大小</h4> <p>当我们调整窗口大小时，不可避免地会触发大量调整事件，此时采用<strong>后沿触发防抖</strong>，因为我们只在意窗口最后地大小，我们并不在意中途发生了什么。</p> <p><a href="https://codepen.io/dcorb/pen/XXPjpd" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/XXPjpd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="http://img.gxyhero.top/img/202108101730649.png" alt="image-20210322190202267"></p> <h3 id="带有自动提交ajax请求的输入框中"><a href="#带有自动提交ajax请求的输入框中" class="header-anchor">#</a> 带有自动提交AJAX请求的输入框中</h3> <p>通过<strong>防抖</strong>避免用户在未输入内容前触发AJAX请求，在这里我们仍采用<strong>后沿触发防抖</strong>。</p> <p><a href="https://codepen.io/dcorb/pen/mVGVOL" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/mVGVOL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>一个相似的案例是用户在注册账号时，通过防抖来提示用户什么时候达到了<strong>最短密码长度</strong>。</p> <h2 id="节流"><a href="#节流" class="header-anchor">#</a> 节流</h2> <p>用一句话概况：<strong>使用节流我们可以保证函数在一段时间内执行次数不超过一次</strong>。</p> <p>一个形象的<strong>类比</strong>是机场的安检系统，它一段时间只允许一个人去安检，无论有多少人隔一段时间只准一个人通过安检。</p> <p>与<strong>防抖</strong>相似，我们也可以在<strong>Lodash</strong>和<strong>underscore.js</strong>中找到节流的实现。</p> <h2 id="节流实例"><a href="#节流实例" class="header-anchor">#</a> 节流实例</h2> <h3 id="无限下拉"><a href="#无限下拉" class="header-anchor">#</a> 无限下拉</h3> <p>这是一个非常常见的案例，在很多网页中都有使用，想要实现无限下拉需要在用户下拉时检测距离底部还有多远，如果接近底部了，就发送一个AJAX请求获取更多数据来填充网页。</p> <p>在这个案例中<strong>防抖</strong>技术就显得不那么合适了，我们显然不希望用户不断下拉导致页面始终不更新的情况发生。使用<strong>节流</strong>我们确保不断地检查距底部的长度，而由不会造成太大负载。</p> <p><a href="https://codepen.io/dcorb/pen/eJLMxa" target="_blank" rel="noopener noreferrer">https://codepen.io/dcorb/pen/eJLMxa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="如何使用防抖、节流以及一些小坑"><a href="#如何使用防抖、节流以及一些小坑" class="header-anchor">#</a> 如何使用防抖、节流以及一些小坑</h2> <p>相较于自己手写<strong>防抖节流</strong>或者从其他blog上复制过来，更推荐使用<strong>Lodash</strong>中现成的实现，引入模块的方式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>npm i -g lodash-cli
lodash include=debounce,throttle
</code></pre></div><p>注意空格。</p> <p>一个常犯的使用错误就是多次调用<strong>防抖</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//错误调用</span>
<span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
_<span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span>doSomething<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//正确调用</span>
<span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span>_<span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span>doSomething<span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="requestanimationframe-请求动画帧"><a href="#requestanimationframe-请求动画帧" class="header-anchor">#</a> requestAnimationFrame(请求动画帧)</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> cancel<span class="token operator">=</span>window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//callback为下次重绘前更新动画帧所用函数</span>
window<span class="token punctuation">.</span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span><span class="token comment">//取消回调函数</span>
</code></pre></div><p><strong>rAF</strong>是另一种限制函数调用速度的方式，它有点类似<code>_.throttle(doSomething,16)</code>但是它具有更高的保真性，因为它是浏览器为了高准确性而提供的原生API。我们可以使用<strong>rAF</strong>去替代<strong>throttle</strong>，替换时考虑以下优缺点：</p> <p>优势：</p> <ul><li><strong>rAF</strong>表现为60fps,但它的内部会制定最优的渲染策略。</li> <li>简单地使用标准的API，不用担心后续的维护问题。</li></ul> <p>劣势：</p> <ul><li><strong>rAF</strong>的开始\取消需要人为控制，不像<strong>防抖节流</strong>那样内部实现好。</li> <li>如果浏览器标签没用运作，那么rAF也不会运作。</li> <li>需要考虑低版本浏览器的兼容问题。</li> <li><strong>rAF</strong>不支持node.js</li></ul> <p>按照经验来看，<strong>rAF</strong>适用于涉及重计算元素位置的绝大部分情况，如绘画或对动画元素直接操作。对于处理AJAX请求或者增删某个类（涉及css动画）时使用<strong>防抖节流</strong>效果更好，因为你可以达到60fps以上。</p> <p>需要注意的是，<strong>Lodash</strong>和<strong>underscore</strong>都不包含<strong>rAF</strong>，因为在浏览器直接调用就已经足够了。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li><strong>防抖</strong>：允许我们将一组同一函数的触发序列合并为一次触发，即多化一。</li> <li><strong>节流</strong>：保证函数在一段时间内执行次数不超过一次。</li> <li><strong>请求动画帧</strong>：节流的替代品，当你的js涉及计算及重渲染时效果更好。</li></ul> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <blockquote><p>https://css-tricks.com/debouncing-throttling-explained-examples/#resize-example</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/10/2021, 9:48:53 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/js/JS习题册答案.html" class="prev">
        JS习题册答案
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.698492e0.js" defer></script><script src="/assets/js/2.1aeebccc.js" defer></script><script src="/assets/js/26.104728fd.js" defer></script><script src="/assets/js/3.aa8f0b53.js" defer></script>
  </body>
</html>
