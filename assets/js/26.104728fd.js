(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{453:function(t,s,a){"use strict";a.r(s);var n=a(32),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"防抖、节流和raf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防抖、节流和raf"}},[t._v("#")]),t._v(" 防抖、节流和RAF")]),t._v(" "),a("h2",{attrs:{id:"什么是防抖、节流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是防抖、节流"}},[t._v("#")]),t._v(" 什么是防抖、节流？")]),t._v(" "),a("p",[a("strong",[t._v("防抖")]),t._v("和"),a("strong",[t._v("节流")]),t._v("是两个十分相似但不同的概念，它们都用于控制一段时间内函数调用的次数。")]),t._v(" "),a("p",[t._v("当我们的函数对DOM事件响应时，"),a("strong",[t._v("防抖")]),t._v("和"),a("strong",[t._v("节流")]),t._v("效果更加明显。需要注意的是，"),a("strong",[t._v("防抖")]),t._v("和"),a("strong",[t._v("节流")]),t._v("并没有控制DOM事件的触发频率，他们只是在事件发生与函数被调用这个过程中充当了一个缓冲层。")]),t._v(" "),a("h2",{attrs:{id:"为什么需要防抖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要防抖"}},[t._v("#")]),t._v(" 为什么需要防抖？")]),t._v(" "),a("p",[t._v("以常见的"),a("strong",[t._v("sroll")]),t._v("（滚动）事件为例：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/PZOZgB",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/PZOZgB"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("执行上述代码，我们会发现滚动事件的触发频率非常高，可能只是轻轻拖动了下滚动条就触发了20次事件。事实上在手机上，滚动事件触发的频率会更高，这么高频事件触发无疑大大增加了事件处理函数的压力。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.gxyhero.top/img/202108101729568.png",alt:"image-20210322172132353"}})]),t._v(" "),a("h2",{attrs:{id:"仔细聊聊防抖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仔细聊聊防抖"}},[t._v("#")]),t._v(" 仔细聊聊防抖：")]),t._v(" "),a("p",[t._v("用一句话概况："),a("strong",[t._v("防抖允许我们将一组同一函数的触发序列合并为一次触发，即多化一")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v("The Debounce technique allow us to “group” multiple sequential calls in a single one.")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.gxyhero.top/img/202108101730772.png",alt:"debounce"}})]),t._v(" "),a("p",[t._v("观察上图，比较原生事件触发与带"),a("strong",[t._v("防抖")]),t._v("的事件触发机制。需要注意的是"),a("strong",[t._v("即使事件并不是连续触发的，也会被合并为一次触发")]),t._v("（当然不能间隔太久，这个gap可以自定，后面会说到）。")]),t._v(" "),a("p",[t._v("有一个较为形象的"),a("strong",[t._v("类比")]),t._v("：想象你现在处在一个电梯中，就在电梯门即将关闭的时候，一个人进来了，电梯不得不延迟升降，打开门让它进来，然后快关闭时又来了一个人，电梯门又开了……虽然这样推迟了电梯的升降，但是却让电梯的空间得以被充分利用。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/KVxGqN",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/KVxGqN"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("打开这个链接试着在Trigger area中拖动鼠标，你能清晰看到，防抖通过"),a("strong",[t._v("合并")]),t._v("，大大减少了事件触发的次数。（这里强调了合并，因为就像一开始说的那样，防抖并没有改变事件触发的频率，它只是帮我们整理了一下）")]),t._v(" "),a("h2",{attrs:{id:"前沿-immediate-触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前沿-immediate-触发"}},[t._v("#")]),t._v(" 前沿(immediate)触发")]),t._v(" "),a("p",[t._v("我们发现上面的"),a("strong",[t._v("防抖")]),t._v("总在事件停止“抽搐”后才触发函数，这样有时对体验影响很大，为什么不能让函数立即被触发呢？就好像没有使用"),a("strong",[t._v("防抖")]),t._v("时的那样。事实上，在"),a("code",[t._v("underscore.js")]),t._v("中，这个选项被称为"),a("strong",[t._v("immediate")]),t._v("。下面是前沿触发防抖的例子：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/GZWqNV",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/GZWqNV"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("对比之前的可以发现，函数的触发处在序列的前沿了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.gxyhero.top/img/202108101730878.png",alt:"debounce-leading"}})]),t._v(" "),a("h2",{attrs:{id:"防抖实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防抖实现"}},[t._v("#")]),t._v(" 防抖实现")]),t._v(" "),a("p",[a("strong",[t._v("防抖")]),t._v("这个概念最早在2009年由John Hann在他的文章中提出：")]),t._v(" "),a("blockquote",[a("p",[t._v("http://unscriptable.com/2009/03/20/debouncing-javascript-methods/")])]),t._v(" "),a("p",[t._v("目前"),a("strong",[t._v("underscore.js")]),t._v("和"),a("strong",[t._v("Lodash")]),t._v("中都有实现防抖，虽然它们具体实现的方式不同，但是接口无疑都是一样的。")]),t._v(" "),a("p",[a("strong",[t._v("Lodash")]),t._v("为"),a("strong",[t._v("防抖")]),t._v("和"),a("strong",[t._v("节流")]),t._v("增加了更多的细节，如上文提及的"),a("strong",[t._v("immediate")]),t._v("选项已经被替换为"),a("strong",[t._v("leading")]),t._v("(前沿)和 "),a("strong",[t._v("trailing")]),t._v("（后沿）供程序员选择，"),a("strong",[t._v("默认情况下采用后沿触发防抖")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"防抖实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防抖实例"}},[t._v("#")]),t._v(" 防抖实例")]),t._v(" "),a("h4",{attrs:{id:"改变窗口大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改变窗口大小"}},[t._v("#")]),t._v(" 改变窗口大小")]),t._v(" "),a("p",[t._v("当我们调整窗口大小时，不可避免地会触发大量调整事件，此时采用"),a("strong",[t._v("后沿触发防抖")]),t._v("，因为我们只在意窗口最后地大小，我们并不在意中途发生了什么。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/XXPjpd",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/XXPjpd"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.gxyhero.top/img/202108101730649.png",alt:"image-20210322190202267"}})]),t._v(" "),a("h3",{attrs:{id:"带有自动提交ajax请求的输入框中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#带有自动提交ajax请求的输入框中"}},[t._v("#")]),t._v(" 带有自动提交AJAX请求的输入框中")]),t._v(" "),a("p",[t._v("通过"),a("strong",[t._v("防抖")]),t._v("避免用户在未输入内容前触发AJAX请求，在这里我们仍采用"),a("strong",[t._v("后沿触发防抖")]),t._v("。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/mVGVOL",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/mVGVOL"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("一个相似的案例是用户在注册账号时，通过防抖来提示用户什么时候达到了"),a("strong",[t._v("最短密码长度")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"节流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节流"}},[t._v("#")]),t._v(" 节流")]),t._v(" "),a("p",[t._v("用一句话概况："),a("strong",[t._v("使用节流我们可以保证函数在一段时间内执行次数不超过一次")]),t._v("。")]),t._v(" "),a("p",[t._v("一个形象的"),a("strong",[t._v("类比")]),t._v("是机场的安检系统，它一段时间只允许一个人去安检，无论有多少人隔一段时间只准一个人通过安检。")]),t._v(" "),a("p",[t._v("与"),a("strong",[t._v("防抖")]),t._v("相似，我们也可以在"),a("strong",[t._v("Lodash")]),t._v("和"),a("strong",[t._v("underscore.js")]),t._v("中找到节流的实现。")]),t._v(" "),a("h2",{attrs:{id:"节流实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节流实例"}},[t._v("#")]),t._v(" 节流实例")]),t._v(" "),a("h3",{attrs:{id:"无限下拉"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无限下拉"}},[t._v("#")]),t._v(" 无限下拉")]),t._v(" "),a("p",[t._v("这是一个非常常见的案例，在很多网页中都有使用，想要实现无限下拉需要在用户下拉时检测距离底部还有多远，如果接近底部了，就发送一个AJAX请求获取更多数据来填充网页。")]),t._v(" "),a("p",[t._v("在这个案例中"),a("strong",[t._v("防抖")]),t._v("技术就显得不那么合适了，我们显然不希望用户不断下拉导致页面始终不更新的情况发生。使用"),a("strong",[t._v("节流")]),t._v("我们确保不断地检查距底部的长度，而由不会造成太大负载。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://codepen.io/dcorb/pen/eJLMxa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://codepen.io/dcorb/pen/eJLMxa"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"如何使用防抖、节流以及一些小坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用防抖、节流以及一些小坑"}},[t._v("#")]),t._v(" 如何使用防抖、节流以及一些小坑")]),t._v(" "),a("p",[t._v("相较于自己手写"),a("strong",[t._v("防抖节流")]),t._v("或者从其他blog上复制过来，更推荐使用"),a("strong",[t._v("Lodash")]),t._v("中现成的实现，引入模块的方式如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i -g lodash-cli\nlodash include=debounce,throttle\n")])])]),a("p",[t._v("注意空格。")]),t._v(" "),a("p",[t._v("一个常犯的使用错误就是多次调用"),a("strong",[t._v("防抖")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//错误调用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'scroll'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debounce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doSomething"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//正确调用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'scroll'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debounce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doSomething"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"requestanimationframe-请求动画帧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestanimationframe-请求动画帧"}},[t._v("#")]),t._v(" requestAnimationFrame(请求动画帧)")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" cancel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//callback为下次重绘前更新动画帧所用函数")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cancel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//取消回调函数")]),t._v("\n")])])]),a("p",[a("strong",[t._v("rAF")]),t._v("是另一种限制函数调用速度的方式，它有点类似"),a("code",[t._v("_.throttle(doSomething,16)")]),t._v("但是它具有更高的保真性，因为它是浏览器为了高准确性而提供的原生API。我们可以使用"),a("strong",[t._v("rAF")]),t._v("去替代"),a("strong",[t._v("throttle")]),t._v("，替换时考虑以下优缺点：")]),t._v(" "),a("p",[t._v("优势：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("rAF")]),t._v("表现为60fps,但它的内部会制定最优的渲染策略。")]),t._v(" "),a("li",[t._v("简单地使用标准的API，不用担心后续的维护问题。")])]),t._v(" "),a("p",[t._v("劣势：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("rAF")]),t._v("的开始\\取消需要人为控制，不像"),a("strong",[t._v("防抖节流")]),t._v("那样内部实现好。")]),t._v(" "),a("li",[t._v("如果浏览器标签没用运作，那么rAF也不会运作。")]),t._v(" "),a("li",[t._v("需要考虑低版本浏览器的兼容问题。")]),t._v(" "),a("li",[a("strong",[t._v("rAF")]),t._v("不支持node.js")])]),t._v(" "),a("p",[t._v("按照经验来看，"),a("strong",[t._v("rAF")]),t._v("适用于涉及重计算元素位置的绝大部分情况，如绘画或对动画元素直接操作。对于处理AJAX请求或者增删某个类（涉及css动画）时使用"),a("strong",[t._v("防抖节流")]),t._v("效果更好，因为你可以达到60fps以上。")]),t._v(" "),a("p",[t._v("需要注意的是，"),a("strong",[t._v("Lodash")]),t._v("和"),a("strong",[t._v("underscore")]),t._v("都不包含"),a("strong",[t._v("rAF")]),t._v("，因为在浏览器直接调用就已经足够了。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("防抖")]),t._v("：允许我们将一组同一函数的触发序列合并为一次触发，即多化一。")]),t._v(" "),a("li",[a("strong",[t._v("节流")]),t._v("：保证函数在一段时间内执行次数不超过一次。")]),t._v(" "),a("li",[a("strong",[t._v("请求动画帧")]),t._v("：节流的替代品，当你的js涉及计算及重渲染时效果更好。")])]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("blockquote",[a("p",[t._v("https://css-tricks.com/debouncing-throttling-explained-examples/#resize-example")])])])}),[],!1,null,null,null);s.default=r.exports}}]);